"""
This file implements tests for various parts of the Falcon.py library.

Test the code with:
> make test
"""
from falcon import SecretKey, PublicKey, Params
from falcon import SALT_LEN, HEAD_LEN, SHAKE256
#from scripts.sign_KAT import *


sign_KAT512 = [
    {
        "read_bytes": 53332,
        "f": [-7, 2, 3, 3, 6, 5, -2, 1, 5, -1, 3, 0, 2, 2, 5, -3, 2, 1, 4, 0, 6, 0, 4, 3, -1, -6, 1, -2, 0, 1, -3, -7, 2, 2, -1, 2, 6, -5, -6, 3, 0, 8, 3, 3, 8, -1, 1, -13, 0, -1, 4, -7, -10, -1, -2, 5, 5, 1, 1, -1, 4, -2, -2, 1, 1, -1, 1, 1, -3, 3, 8, 3, -1, 3, -1, 2, 1, 2, 1, 1, -5, 3, 5, 4, 4, 6, -1, 1, 1, -5, -1, 4, -1, 7, 2, -1, -6, 4, -2, 2, 6, 2, 9, -4, -7, 2, 5, 2, 6, -2, 4, -2, -4, -3, 3, 3, 1, 0, 10, -6, 11, -2, 10, -9, -2, 1, -6, 5, -5, 0, -4, 7, -1, -1, -5, 0, 5, 0, 3, 5, 5, 0, 2, -1, -1, 5, -3, 0, -3, 2, -5, 2, 7, 5, -4, -4, -3, 9, 0, 0, -2, -1, -1, 4, 2, -1, 0, -1, 3, -7, 4, 6, 6, 5, 2, -1, -3, 5, -8, -5, 4, -3, -2, -3, -5, 9, 2, 0, -1, 1, 7, 0, 5, -4, 3, -6, 0, 3, -1, -6, -4, 3, -3, 9, 10, 3, 0, 2, -3, 5, 0, -5, -1, 4, 0, 5, 3, 3, -9, -6, 5, -5, 1, -8, -6, 4, 3, -6, 1, -1, -2, 3, -3, 1, -2, -2, 2, 3, -1, 1, 5, -2, 2, -2, 2, 3, 3, 3, 5, -2, 11, 4, -3, -1, 5, -7, 3, 3, 5, 4, -1, 5, -4, -7, -5, 2, -5, -3, -2, -1, 4, -2, -1, 0, -3, 2, 4, -3, 3, 1, 4, 0, 3, 0, 1, -5, 3, 1, 3, 0, -5, -6, -4, -4, 6, 3, 7, -3, 3, 5, -1, -2, -2, -4, 1, -9, -6, -3, -6, 3, 2, -3, -3, -4, 2, 8, 1, 3, -7, -2, -2, 3, -1, -1, 4, -2, 3, 2, 5, -4, -5, 0, -2, 4, 1, -1, -2, -1, -2, -4, 1, -1, 1, -3, 1, -1, 0, -3, 5, -4, -3, 7, -2, 1, 0, 1, 4, 1, 0, 0, -5, 4, 1, 4, 0, -2, 1, 4, -3, 1, 0, -2, -2, 8, -1, -2, 2, -1, -1, -1, -1, 7, -7, 0, 5, -7, 5, -5, 0, -4, -1, 1, -7, -2, 1, 1, -2, -1, 1, -2, -3, -4, 5, -4, 1, 4, -5, -7, 1, 4, 0, -6, -7, 2, 9, 0, -5, 1, -8, -6, -1, 3, 1, 8, -10, 2, 0, 4, -6, -5, -4, -1, 3, 0, 4, -2, -8, 0, -5, 3, -3, 1, 3, -2, 3, 0, 6, 2, 0, -9, -4, 0, -5, 3, 0, -4, 4, 3, 1, -3, 2, 9, 2, -5, 2, -8, -2, -1, 4, -1, -4, 4, 4, 1, -4, -8, -1, -4, 5, 2, -3, 2, 0, 2, -1, 1, 7, -1, -1, 0, -1, 0, 0, 5, -4, 2, 0, -5, 5, -5, 8, -2, 2, 3, 0, -1, -4, -2, -4, 6, 3, -8, ],
        "g": [4, -4, -3, -2, 1, 5, -7, -5, 3, 4, -4, -4, 3, 10, -6, -1, 5, -7, -3, -4, -4, 3, -3, 7, 2, -4, 2, 2, -2, 0, 7, 3, -2, -1, -1, -2, -2, -2, -1, -6, -6, 0, -3, 4, 7, 2, 1, 2, -3, 1, -3, -10, 2, 2, -2, 0, -5, -1, -1, 6, -3, -4, 9, 3, -7, 7, 1, 4, 2, 1, 2, 5, -1, -4, -5, -7, 1, 6, 4, -2, -2, 1, 4, -4, 0, -1, 8, 2, 8, -2, 4, 2, -7, 0, -4, 5, -2, -2, -1, 2, -3, -7, 2, -7, -1, 5, -4, 3, -4, -2, 0, 3, 0, 3, 1, 1, 2, 3, -8, 1, 1, -3, 10, -4, 1, 5, 3, -6, 4, -2, -4, -3, 2, -1, -2, -1, -3, 1, -5, 1, 2, 7, 0, -5, 1, 6, -1, 2, 3, -5, -1, 1, -2, -3, 2, 0, 6, 1, -3, 0, 1, -1, 0, 7, 2, -1, -6, -6, 12, 3, 0, 7, 2, 9, -4, -5, 4, 0, -5, 5, -5, 6, 0, -2, 0, -1, 3, 4, 6, -5, -1, -7, 2, 2, 1, 3, 0, 6, 5, 1, 4, -2, -10, -8, -3, 1, 1, -3, -5, 4, 0, 4, 3, 3, -1, -2, -7, 1, 6, 1, 0, -3, 3, -1, -2, -3, -10, -1, -2, -4, 4, -1, -6, 1, 8, -2, 6, -2, -2, -2, 0, -4, -2, -3, 5, -4, 2, -4, 0, 4, 1, 2, 2, 3, -1, 2, 6, 9, 2, -6, 0, 6, -2, 1, -11, -1, 5, -2, -5, 0, 3, -2, -1, -1, -2, 5, -1, 4, 0, -7, -5, 3, 8, 4, 0, -1, 2, -1, 1, 0, -1, 2, -4, 6, -6, -1, -10, -4, 8, 6, 3, 4, -1, 2, 2, 8, 0, 0, 6, 1, -3, -1, 0, 1, -5, 4, 0, -5, -3, 10, 0, -7, -3, -3, -6, -2, -5, 0, -7, -4, -3, 4, 2, 0, 1, 3, -2, 2, -3, -3, -9, 6, 1, -6, -1, 2, -3, -1, 0, -8, 1, -5, 2, 0, -2, -6, -1, -3, 1, 2, -1, 2, 5, 9, -1, 2, 2, 4, 2, 2, -5, 1, 3, 1, -5, 0, 3, -4, -3, 4, -4, 1, 1, -2, 1, 0, 1, -4, 0, 2, -4, -2, -2, -3, 5, 1, -2, 0, -3, -8, 4, 3, 5, 6, -3, -5, -2, -2, -6, 5, 1, 5, -1, -9, 1, 3, 0, -2, -3, -5, -5, 1, -2, 4, -1, 1, -3, 1, -2, -3, 5, 5, -2, 0, -1, 4, 1, -2, -7, -1, 3, -9, -7, 0, 4, 4, 6, 1, -9, 4, 3, -1, 4, -4, -2, 7, 1, 2, 5, 3, -4, -10, 3, -3, -1, 7, -6, 3, 2, -5, -1, -1, 4, 0, 1, -5, -1, -1, -5, -1, -5, -2, 2, 0, 5, 2, -1, -4, -1, 3, 1, 2, -3, 2, 9, 6, -6, 5, -6, -3, -5, 0, 7, -1, -8, 0, -1, -3, 4, 1, -2, 0, ],
        "F": [13, 30, 48, 15, 4, -25, -16, -20, 39, 27, 10, -29, 21, 16, 49, -14, 29, -39, 32, 26, -17, -33, 19, 0, 12, 4, 30, 9, -27, 41, 66, -29, -3, 26, 39, -58, 22, 0, -17, -18, 32, 41, -12, -5, 19, 39, -10, 45, -43, 13, 28, 49, -1, -31, 3, -48, -6, 28, 2, 11, -2, 40, 16, 23, -31, 1, 30, 8, -10, -51, 24, -43, 37, 4, 26, 27, -31, 5, -10, 12, 20, -17, 14, 22, 10, 7, 5, 14, 5, -14, -3, 20, 19, -5, -20, 5, 10, 7, -13, -53, -39, 4, -24, -10, -6, -32, -2, 7, -12, 50, 2, -3, 11, 3, 20, 6, -26, -25, -12, 32, -2, 45, 12, -25, 21, -13, -7, -42, 28, 14, -32, 20, 47, 13, -3, -8, -31, -18, 26, 24, 5, 8, -26, -5, -26, 27, 4, 0, 23, 63, 30, -3, 13, 41, 42, 4, 54, 35, 25, -4, 10, -3, 5, -8, -36, 6, -56, 47, -17, 50, 17, -11, -29, -43, -8, -7, -15, 17, 3, -15, -27, 49, -14, 5, -21, 5, -27, -72, 12, 4, 33, -15, 6, 37, -10, 8, 25, 37, -36, 0, 8, -35, 1, -13, -15, -11, 15, -21, 20, 11, 2, -2, -65, -5, 23, -8, -1, -33, 14, 9, 28, 40, -19, -10, 12, 43, -5, 57, 21, -14, 47, -59, -4, -18, -4, 10, -62, 9, -12, -43, 49, 4, -50, -21, 3, 23, 16, -4, -21, -15, -2, -3, 13, -25, -18, 52, -13, -12, 12, -22, -2, -8, 36, -11, 50, 11, 36, 15, 22, 34, -24, -6, -16, 43, -36, -19, 9, -8, 12, -7, -17, -9, -3, 11, -12, 45, -1, 25, -8, -42, -4, -22, 10, -42, 30, -38, 5, -3, 19, 2, -2, 25, -14, -7, 1, -2, 0, -3, -20, -35, -10, -3, -25, -35, 0, 40, -8, -27, -35, -35, 0, -7, 6, -5, -11, 41, 17, 5, -10, -6, -22, -37, 11, -10, -28, 10, -27, -2, -17, -3, -80, 11, -5, 41, -3, -2, 17, -22, 7, -52, 20, -4, -10, 19, -39, 8, 36, -16, -43, 30, 16, -21, 10, -4, 22, 8, 0, -7, -32, 13, -22, 34, -4, 10, 2, -11, -23, 7, 30, -2, -25, -8, -3, 35, 1, 14, -40, 54, -41, 22, 5, 29, 58, -21, 15, 1, 23, -44, 26, 8, 8, -36, 29, -9, 70, 3, 4, 5, -15, -15, -4, -56, -9, 10, 10, -60, 7, -23, -10, -3, -8, 16, -6, -17, 41, -40, -33, -4, -23, -22, 14, 2, 9, -1, 27, 31, -31, -9, -8, -38, -47, 10, 4, 3, -33, 43, -23, 4, 16, 24, -20, 10, 0, -36, 0, -74, -42, -17, 50, 3, 8, 28, 29, -2, -29, 39, -6, -26, -12, -10, 46, 1, -1, -17, -12, -2, -56, 13, -40, 22, -32, -10, 92, -32, 31, -22, 23, 19, -4, -30, -23, 8, -34, 6, -13, -14, -25, 12, 22, -11, 8, -18, 9, -44, 13, -27, 32, -22, 0, -40, 63, 38, ],
        "G": [-72, 21, -29, -41, 28, 23, 27, -61, -68, -14, -9, 1, 22, 43, 26, 22, -30, 41, 11, -25, 27, -46, -20, 30, -36, -6, -33, 3, 45, 17, -41, -24, -18, -13, 58, -24, 15, 20, -4, -21, 2, 14, 0, -18, 1, 19, 31, 10, -55, 21, 12, -38, -11, -30, 22, 13, 15, -15, -38, 5, 14, -23, -1, 24, 24, -52, 1, 10, -1, 59, 32, 9, 9, -1, -3, 6, 29, 53, -44, -44, 12, 24, 13, 35, -4, -38, 6, 30, 20, -14, -10, 3, 33, 21, 25, 29, 49, -48, 31, 47, -30, -6, -7, 2, -28, 14, 25, 12, -17, 10, -20, -13, -10, -20, -12, 30, -2, 14, 6, 28, -1, 12, -28, -65, 8, 36, -60, 4, -29, -20, 39, -7, -19, 45, 15, -55, -11, 19, 57, 14, 12, -48, 15, 38, -47, 0, 16, -41, -37, -55, -7, 1, 12, -29, -20, 49, 1, -11, 52, 22, 24, -20, -9, -6, -1, 24, -17, -35, -18, 40, -29, -27, 3, -8, 3, 2, 16, 44, 23, 8, 40, -12, 31, 24, -91, -14, -2, 39, 15, -23, -39, -9, 7, 38, 45, -42, 16, 16, 34, -39, 48, 52, 45, -15, 37, -19, -31, 21, 41, 48, -11, -38, 20, -33, -28, 4, -6, 1, -1, 25, 11, 26, -18, 31, -38, 29, 18, -43, -4, 6, 20, -29, -45, 4, -20, 56, 39, -7, -32, -45, -16, -16, -14, -32, 21, -31, -9, 13, -25, 9, 15, 40, -32, -12, -1, -40, 4, 4, -13, -1, 0, 37, -4, -67, -41, -23, 3, -9, -48, 12, 6, 31, -2, 22, 6, -3, -20, -2, 21, 0, -27, -11, 5, 19, 20, 22, -16, -7, 10, 22, 31, -15, -3, -10, 28, -17, -12, -54, -6, -8, -34, -5, -28, -9, -6, 10, 41, -17, 3, 24, 23, 9, 15, -1, 1, -3, -26, 15, 15, -15, 9, 17, -2, 13, -32, -23, -35, 34, 4, 13, 24, 14, -4, -3, 28, -51, 9, -32, -21, 21, -31, -46, -12, 27, 2, -13, 23, -5, -2, 33, -34, -39, -1, 22, 11, 52, 15, -61, 8, -35, -18, -47, -8, -7, 0, -34, 29, 1, -1, -25, 30, 12, -2, 13, -11, -14, -6, -11, 22, -19, -5, -29, -9, 38, 14, -33, -32, -19, -21, -10, 1, 42, -29, 31, -23, -24, 53, -12, -17, -25, 14, 34, 37, -17, 3, -22, -12, 32, -56, 3, 0, -17, 6, 22, -22, 12, -34, -25, -13, 51, -17, -15, 8, 1, 22, 8, 34, 12, 12, 1, -44, 0, 31, 2, -25, -25, -11, 8, 22, 15, 47, 35, 15, -31, 8, 17, -8, -41, -32, -1, 29, 20, -20, -18, 42, 13, -48, 33, -3, -1, -20, 29, -11, -1, -3, -12, -13, -38, -4, -6, 13, -19, 6, -9, 19, 53, -28, -47, 4, -29, -36, -21, 29, 26, -22, 6, 14, 19, -16, 15, 3, -43, -23, 8, -9, 28, 1, -48, -22, 18, -28, 17, 2, 19, -19, 18, 17, 51, 21, -36, -11, 41, ],
        "nonce": "6ef355a73884a445da06224862bff01b287645d9d7f5a187302b60dd511a377cbac676d971183536",
        "prng_seed": "6e06d359780acecdaee7527569f7cd389488bfe9fae4b840bc1e89103cb051dd4345f860ef97c8fa028e4e60f8e217361fed4a15cab92a94",
        "s2": [91, -156, -55, 148, 16, 237, 1, -56, -85, 369, -105, 10, 90, 174, 131, -99, -365, 372, 98, 89, -101, 111, 54, 223, -243, -15, 110, -224, -139, -45, 324, -197, 30, 119, -30, 83, 246, -547, 31, 17, 156, -134, -137, 62, 107, 71, -196, -138, 410, -246, 102, -250, 129, 224, 184, 17, -15, -113, -81, 207, 149, 60, 56, 76, 54, 71, -42, 11, -114, 22, 4, 23, 217, -286, 82, -173, -143, 83, -154, -320, -210, -80, 127, -181, 35, 357, 184, -35, 188, -73, 174, 484, -140, 283, 103, -54, 315, 33, 70, -70, 17, -248, -206, -92, -210, 28, 35, -159, 32, -74, 134, -9, 80, -179, 111, -136, 31, 54, 44, -193, -72, -3, 77, 199, 239, -25, 53, 220, -10, 36, -235, -293, 54, -293, 372, -28, -128, -315, 27, -288, -205, -310, -76, 176, 193, 141, -130, 39, -6, -120, -127, -107, -20, 6, 90, -154, -68, -48, -173, 14, 147, 141, 104, 59, 162, 228, 26, 184, 11, 153, 13, -208, 44, -68, -157, 237, -52, -128, 9, -71, -12, -75, -93, 192, 62, 121, -229, -15, -91, -204, -117, 44, 143, 187, 108, -145, -308, 9, 389, -93, -283, 44, 302, 45, 185, 196, -42, -52, 124, 147, -116, -62, -402, 175, -162, -273, 30, -202, 327, 282, 314, 268, 311, -146, -135, 148, -128, -155, 207, 261, 262, 190, -50, 120, 175, 145, 75, -26, -228, -134, 396, 108, -107, -96, -125, 34, -137, 171, -80, 48, 305, 190, -113, -131, -5, 10, 108, -166, -65, 159, 41, -118, 57, -14, 0, -204, 20, -70, -121, -16, -31, -60, -84, -60, 169, -206, 192, -285, -130, -171, -10, -137, -238, 23, -21, 27, -47, -101, -91, -420, 81, 44, 130, 20, 361, -37, -158, -237, -82, -186, -9, -83, 202, 40, 181, -116, 60, -86, 169, -71, 267, -18, 77, 353, -184, 44, -49, 52, 121, -66, 35, -193, 63, 193, -67, 33, 229, 161, -167, 253, 56, 173, 152, -216, 32, 208, -353, -284, -273, 50, -144, -71, 14, 11, 180, 146, -304, 123, 189, -26, -288, -38, -170, -31, -120, 145, 242, 199, -83, 113, -2, -55, -123, 48, 205, 139, -233, 125, 302, 49, 62, 59, -314, -147, -149, -284, 167, 147, -14, 39, 124, -48, -29, 288, 130, -96, -43, 184, -154, -491, -182, 293, -67, 166, 162, -115, 11, -93, 186, -39, 136, -215, -192, -79, -91, 26, -155, 165, -18, 163, -85, -181, 98, 175, 142, 104, -286, 11, 200, 369, 94, 10, -17, -152, 29, -97, -124, -4, -179, 117, 75, 271, -225, 148, -132, -12, 80, -55, 65, -74, -109, 98, -273, -150, 264, 277, 136, -77, 196, 264, -114, 144, 48, -246, 69, -21, 272, -23, -257, 45, -248, 67, 15, 83, 87, 154, -79, -3, 130, 219, 121, -67, 90, 187, -308, -280, -212, -231, -184, 287, 8, -176, 120, 31, 153, -236, 210, -375, -30, -83, 286, 18, 146, 261, -260, -11, 89, -42, -18, -226, -105, -233, 341, 113, -228, 139, 108, 247, -34, -122, 4, -98, ],
        "sig": "396ef355a73884a445da06224862bff01b287645d9d7f5a187302b60dd511a377cbac676d9711835365bce36f14442da80ee3ab713d30aad4b90378fda5d0b1567cb6f9b57df363edde062dada21c547aef9ea9dd9a308fc4638c33129f5ae8fc46291a1f659bf480ac09c2238ff8f469e8aa7938a64da8faa85fca2d048bd659e2a5ad63d53cd380749d0bfed523b293868e78e4cb96418c46cb3eda764868dc688fe1ce773a48e48f3e9072a0cc4d4366b7e211f9b4b382e460e9b475bd999ad718a927ada526da52e867300dd91bd01cd6d8e64c1414358249f0df8fffaf2906ad669c4d86b50e89a1ab44ee44b22353842e3286f412ce26756d6d30084f1f19cbeed013ebcf958fedf31f59643d3b5b322da109828eee6c964b896ce5446ab697c89be9bec9097b44c891ee528e4689d10c26e649874518066d4f4148313e6caf12f4454bcd791864305b3d7e0fec8b1295ba1309893e7c706c2c2ad9a67063e94fda738e8073114e37e7219fde753792973940674c1356c5625ee45f2b1bd7f97b7a41519640914b49a5cf3dae96e989e9d29289abe93ceb4a5c785992a6d84dc259b19a5e78523e0a7f4170e4365485a75f53896a30ec24150784ce1912659071e1d0b9a224d817b9eb35a034daa67ff1115c94774ee382dbfee614d42de95f65c4c67d3bdd1936559c24e89b1d27be6c33b20204f06ae70cd3d636c929c393244f9c2fbb3a69e10ebb80e7f6e359b4959291babb558a5e872d19e217485c4af42b2398477c3fcc26cd75a5c3cf0a28c231950dbd0795edb1644cb2104548439b44420f944130fb28b9588197c092dfc2870fa9d5e34e7e0e04adaf3c3ad4edb4330751e76e11f211b05e23f197b1527dccf74e3c44a248298431759d564bc4f4fa5552e3e442d6cbbb45fa8278a000000000000000000",
    },
]


sign_KAT = {
    512: sign_KAT512,
    #1024: sign_KAT1024,
}

def test_sign_KAT():
	message = b"data1"
	for n in sign_KAT:
		print("Testing n = ", n)
		sign_KAT_n = sign_KAT[n]
		for D in sign_KAT_n:
			f = D["f"]
			g = D["g"]
			F = D["F"]
			G = D["G"]
			sk = SecretKey(n, [f, g, F, G])
			pk = PublicKey(sk)
			sig = bytes.fromhex(D["sig"])
			if pk.verify(message, sig) is False:
				return False
	return True


# Run all the tests
if (__name__ == "__main__"):
    print("Test Sig KATs")
    print("Test is OK" if (test_sign_KAT() is True) else "Not OK")